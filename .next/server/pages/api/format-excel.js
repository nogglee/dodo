"use strict";(()=>{var e={};e.id=160,e.ids=[160],e.modules={5600:e=>{e.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},5751:e=>{e.exports=require("xlsx")},9646:e=>{e.exports=require("child_process")},9021:e=>{e.exports=require("fs")},8354:e=>{e.exports=require("util")},7313:e=>{e.exports=import("formidable")},6762:(e,r)=>{Object.defineProperty(r,"M",{enumerable:!0,get:function(){return function e(r,t){return t in r?r[t]:"then"in r&&"function"==typeof r.then?r.then(r=>e(r,t)):"function"==typeof r&&"default"===t?r:void 0}}})},6483:(e,r,t)=>{t.a(e,async(e,o)=>{try{t.r(r),t.d(r,{config:()=>d,default:()=>a,routeModule:()=>f});var s=t(9947),c=t(2706),n=t(6762),i=t(517),l=e([i]);i=(l.then?(await l)():l)[0];let a=(0,n.M)(i,"default"),d=(0,n.M)(i,"config"),f=new s.PagesAPIRouteModule({definition:{kind:c.A.PAGES_API,page:"/api/format-excel",pathname:"/api/format-excel",bundlePath:"",filename:""},userland:i});o()}catch(e){o(e)}})},517:(e,r,t)=>{t.a(e,async(e,o)=>{try{t.r(r),t.d(r,{config:()=>p,default:()=>f});var s=t(7313),c=t(9021),n=t.n(c),i=t(5751),l=t(8354),a=t(9646),d=e([s]);s=(d.then?(await d)():d)[0];let p={api:{bodyParser:!1}},u=(e,r)=>{let t=r[0].map((e,t)=>Math.max(...r.map(e=>e[t]?e[t].toString().length:10)));e["!cols"]=t.map(e=>({wch:e+2}))},A=e=>{let r=e["!ref"]?parseInt(e["!ref"].split(":")[1].match(/\d+/)?.[0]||"2"):2;["C","D","F","H","J","L","N","P","R","T","U","V","W","X","Y","Z",,"AB","AC","AD","AE","AF","AG"].forEach(t=>{for(let o=2;o<=r;o++){let r=`${t}${o}`;e[r]&&(e[r].z="#,##0")}})},h=async e=>new Promise((r,t)=>{(0,s.default)({multiples:!1,uploadDir:"/tmp",keepExtensions:!0}).parse(e,(e,o,s)=>{e?t(e):r({files:s})})});async function f(e,r){if("POST"!==e.method)return r.status(405).json({error:"Method Not Allowed"});try{let{files:t}=await h(e);if(!t.file)return r.status(400).json({error:"File not found or invalid file"});let o=Array.isArray(t.file)?t.file[0]:t.file;if(!o.filepath)return r.status(400).json({error:"Invalid file path"});console.log("\uD83D\uDCCC Processing encrypted file:",o.filepath);let s=o.filepath.replace(".xlsx","_decrypted.xlsx"),c=`/Users/eunjilee/.venvs/dodo_env/bin/python3 decrypt_excel.py "${o.filepath}" "${s}"`;try{let{stdout:e,stderr:r}=await (0,l.promisify)(a.exec)(c);if(console.log("\uD83D\uDCCC Python Output:",e),console.error("\uD83D\uDCCC Python Error:",r),!n().existsSync(s))throw Error(`❌ Decrypted file not found: ${s}`);console.log("✅ Decrypted file created:",s)}catch(e){return console.error("❌ Failed to decrypt file:",e),r.status(500).json({error:"Failed to decrypt file. Check password or encryption type."})}let d=i.readFile(s),f=d.Sheets[d.SheetNames[0]],p=i.utils.sheet_to_json(f,{header:1});console.log("✅ Excel data loaded:",p.length);let m=[];m[0]=["성함","총 오더수","기본 금액","지역단가","배달거리 할증","","픽업지 할증","","도착지 할증","","기상 할증","","기타 프로모션 1","","기타 프로모션 2","","기타 프로모션 3","","기타 프로모션 4","","정산금액","총 지원금","차감내역","합계금액","지사 프로모션","야간 프로모션","과세 항목","비과세 항목","","","","원천세","정산예정 금액"],m[1]=["","","","","오더 수","금액","오더 수","금액","오더 수","금액","오더 수","금액","오더 수","금액","오더 수","금액","오더 수","금액","오더 수","금액","","","","","","","총 전산금액","고용보험","산재보험","시간제보험","보험료소급","",""],console.log("✅ 헤더 추가됨:",JSON.stringify(m[0]),JSON.stringify(m[1])),p.slice(13).forEach((e,r)=>{m[r+2]||(m[r+2]=[]),m[r+2][0]=e[2],m[r+2][1]=e[5],m[r+2][2]=e[6],m[r+2][3]=e[7],m[r+2][4]=e[8],m[r+2][5]=e[9],m[r+2][6]=e[10],m[r+2][7]=e[11],m[r+2][8]=e[12],m[r+2][9]=e[13],m[r+2][10]=e[14],m[r+2][11]=e[15],m[r+2][12]=e[16],m[r+2][13]=e[17],m[r+2][14]=e[18],m[r+2][15]=e[19],m[r+2][16]=e[20],m[r+2][17]=e[21],m[r+2][18]=e[22],m[r+2][19]=e[23],m[r+2][20]=e[24],m[r+2][21]=e[25],m[r+2][22]=e[26],m[r+2][23]=e[27],m[r+2][27]=e[29],m[r+2][28]=e[31],m[r+2][29]=e[32],m[r+2][24]={f:`X${r+3}+IF(B${r+3}>=180,(B${r+3}-180)*1000,0)-X${r+3}`},m[r+2][26]={f:`X${r+3}+Y${r+3}+Z${r+3}`},m[r+2][31]={f:`((AA${r+3}+AB${r+3}+AC${r+3}+AD${r+3}+AE${r+3})*0.967)-(AA${r+3}+AB${r+3}+AC${r+3}+AD${r+3}+AE${r+3})`},m[r+2][32]={f:`AA${r+3}+AB${r+3}+AC${r+3}+AD${r+3}+AE${r+3}+AF${r+3}`}}),console.log("✅ 변환된 데이터:",JSON.stringify(m));let y=i.utils.book_new(),x=i.utils.aoa_to_sheet(m);A(x),x["!merges"]=[{s:{r:0,c:0},e:{r:1,c:0}},{s:{r:0,c:1},e:{r:1,c:1}},{s:{r:0,c:2},e:{r:1,c:2}},{s:{r:0,c:3},e:{r:1,c:3}},{s:{r:0,c:4},e:{r:0,c:5}},{s:{r:0,c:6},e:{r:0,c:7}},{s:{r:0,c:8},e:{r:0,c:9}},{s:{r:0,c:10},e:{r:0,c:11}},{s:{r:0,c:12},e:{r:0,c:13}},{s:{r:0,c:14},e:{r:0,c:15}},{s:{r:0,c:16},e:{r:0,c:17}},{s:{r:0,c:18},e:{r:0,c:19}},{s:{r:0,c:20},e:{r:1,c:20}},{s:{r:0,c:21},e:{r:1,c:21}},{s:{r:0,c:22},e:{r:1,c:22}},{s:{r:0,c:23},e:{r:1,c:23}},{s:{r:0,c:24},e:{r:1,c:24}},{s:{r:0,c:25},e:{r:1,c:25}},{s:{r:0,c:26},e:{r:1,c:26}},{s:{r:0,c:27},e:{r:0,c:30}},{s:{r:0,c:31},e:{r:1,c:31}},{s:{r:0,c:32},e:{r:1,c:32}}],u(x,m),i.utils.book_append_sheet(y,x,"Formatted");let P=s.replace(".xlsx","_formatted.xlsx");i.writeFile(y,P),console.log("✅ Formatted file saved:",P),r.setHeader("Content-Disposition","attachment; filename=formatted.xlsx"),r.setHeader("Content-Type","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet");let $=n().readFileSync(P);r.status(200).send($)}catch(e){console.error("❌ Processing error:",e),r.status(500).json({error:"Failed to process the file"})}}o()}catch(e){o(e)}})},2706:(e,r)=>{Object.defineProperty(r,"A",{enumerable:!0,get:function(){return t}});var t=function(e){return e.PAGES="PAGES",e.PAGES_API="PAGES_API",e.APP_PAGE="APP_PAGE",e.APP_ROUTE="APP_ROUTE",e.IMAGE="IMAGE",e}({})},9947:(e,r,t)=>{e.exports=t(5600)}};var r=require("../../webpack-api-runtime.js");r.C(e);var t=r(r.s=6483);module.exports=t})();